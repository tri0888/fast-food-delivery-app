# orders.api.test

| ID | Test level | Mô tả test case | Inter-test case Dependence | Quy trình kiểm thử | Kết quả mong đợi | Dữ liệu kiểm thử | Kết quả |
| --- | --- | --- | --- | --- | --- | --- | --- |
| API_ORDE_01 | Integration | Verify đặt hàng (PlaceOrder) thành công từ giỏ hàng | API_CART_04 | 1. Seed user có cart + món còn stock<br>2. `POST /api/order/place` với token user và payload items/amount/address<br>3. Đọc order mới tạo trong DB | HTTP `201`, `success: true`, trạng thái đơn = `Pending`, trả về `session_url` (hiện backend trả `200`/`Food Processing`, ghi chú bug) | `TD-API-ORDERS-MENU-ITEMS`, `TD-API-ORDERS-ADDRESS` | FAIL |
| API_ORDE_02 | Integration | Verify đặt hàng thất bại khi giỏ hàng rỗng | Không | 1. Tạo request `items = []`<br>2. `POST /api/order/place` bằng token user<br>3. Quan sát phản hồi | HTTP `400`, message báo phải có ít nhất 1 item | `TD-API-ORDERS-ADDRESS` | FAIL |
| API_ORDE_03 | Integration | Verify User lấy danh sách đơn chỉ thấy đơn của mình | API_ORDE_01 | 1. Seed 2 user + mỗi user 1 order<br>2. `POST /api/order/userorders` bằng token user A<br>3. Kiểm tra `data` | HTTP `200`, `data` chỉ chứa order của user A | `TD-API-ORDERS-USER-EMAIL`, `TD-API-ORDERS-MENU-ITEMS`, `TD-API-ORDERS-ADDRESS` | PASS |
| API_ORDE_04 | Integration | Verify Admin lấy danh sách tất cả đơn | Admin Token | 1. Seed ≥2 orders<br>2. `GET /api/order/list` với token admin<br>3. Đếm số phần tử trả về | HTTP `200`, `success: true`, trả mảng đơn >=2 | `TD-API-ORDERS-USER-EMAIL`, `TD-API-ORDERS-ADDRESS` | PASS |
| API_ORDE_05 | Integration | Verify cập nhật trạng thái Pending -> Confirmed | API_ORDE_01 | 1. Đảm bảo order đang `Pending`<br>2. Admin `PATCH /api/order/status` body `{ status:'Confirmed' }`<br>3. Đọc order sau cập nhật | HTTP `200`, order chuyển sang `Confirmed` (backend hiện reject vì whitelist trạng thái, cần sửa) | `TD-API-ORDERS-MENU-ITEMS`, `TD-API-ORDERS-ADDRESS` | FAIL |
| API_ORDE_06 | Integration | Verify cập nhật sai luồng Pending -> Delivered bị chặn | API_ORDE_01 | 1. Đảm bảo order đang `Pending`<br>2. Admin cố `PATCH /api/order/status` thẳng `{ status:'Delivered' }`<br>3. Kiểm tra thông báo | HTTP `400`, thông báo phải qua `Confirmed` trước; Jest ghi nhận backend cho phép nhảy (bug) | `TD-API-ORDERS-MENU-ITEMS`, `TD-API-ORDERS-ADDRESS` | FAIL |
| API_ORDE_07 | Integration | Verify không thể hủy đơn khi đã Delivering | Admin Token | 1. Seed order trạng thái `Out for delivery`<br>2. Admin `PATCH /api/order/status` thành `Cancelled`<br>3. Quan sát phản hồi | HTTP `400`, message nêu rõ không thể hủy khi đang giao (API hiện trả `Invalid status`, thiếu luồng cancel) | `TD-API-ORDERS-MENU-ITEMS`, `TD-API-ORDERS-ADDRESS` | FAIL |
| API_ORDE_08 | Integration | Verify tính năng xác thực đơn hàng (VerifyOrder) | API_ORDE_01 | 1. Seed order chưa thanh toán<br>2. `POST /api/order/verify` với `{ success: 'true' }`<br>3. Kiểm tra cờ `payment` | HTTP `200`, message `Paid`, cờ `payment=true` | `TD-API-ORDERS-MENU-ITEMS`, `TD-API-ORDERS-ADDRESS` | PASS |
