# cart.api.test

| ID | Test level | Mô tả test case | Inter-test case Dependence | Quy trình kiểm thử | Kết quả mong đợi | Dữ liệu kiểm thử | Kết quả |
| --- | --- | --- | --- | --- | --- | --- | --- |
| API_CART_01 | Integration | Verify thêm vào giỏ (AddToCart) tạo giỏ mới nếu chưa có | User Token | 1. Đăng nhập user hợp lệ để lấy token<br>2. Gửi `POST /api/cart/add` với `itemId` mới<br>3. Đọc phản hồi và DB `cartData` | HTTP `200`, `cartData` xuất hiện item vừa thêm; Jest API suite hiện pass | `TD-API-CART-USER-EMAIL`, `TD-API-CART-FOOD-NAMES` | PASS |
| API_CART_02 | Integration | Verify thêm vào giỏ sản phẩm đã có -> tăng số lượng | API_CART_01 | 1. Dùng lại token + cart từ TC01<br>2. Gửi `POST /api/cart/add` lần nữa với cùng `itemId`<br>3. Đọc `quantity` trong phản hồi | HTTP `200`, số lượng món tăng lên `2` | `TD-API-CART-USER-EMAIL`, `TD-API-CART-FOOD-NAMES` | PASS |
| API_CART_03 | Integration | Verify xóa sản phẩm khỏi giỏ (RemoveFromCart) | API_CART_01 | 1. Đảm bảo cart đang có item từ TC01<br>2. Gọi `POST /api/cart/remove` với `removeCompletely=true`<br>3. Lấy lại cart để so sánh | HTTP `200`, item biến mất khỏi `cartData` | `TD-API-CART-USER-EMAIL`, `TD-API-CART-FOOD-NAMES` | PASS |
| API_CART_04 | Integration | Verify lấy giỏ hàng (GetCart) tính tổng tiền đúng | API_CART_02 | 1. Seed cart với 2 item (giá 15 và 4)<br>2. `GET /api/cart/get` bằng token user<br>3. Tính tổng tiền và đối chiếu response | HTTP `200`, `totalAmount = Σ price * qty` (hiện Jest ghi nhận lỗi backend) | `TD-API-CART-USER-EMAIL`, `TD-API-CART-FOOD-NAMES`, `TD-API-CART-PRICING` | FAIL |
| API_CART_05 | Integration | Verify không thể thêm món ăn với số lượng âm | User Token | 1. Đăng nhập user<br>2. `POST /api/cart/add` với `quantity = -3`<br>3. Quan sát mã lỗi | HTTP `400 Bad Request`, thông điệp báo số lượng phải dương | `TD-API-CART-USER-EMAIL`, `TD-API-CART-FOOD-NAMES`, `TD-API-CART-LIMITS` | FAIL |
| API_CART_06 | Integration | Verify giỏ hàng tự xóa item khi số lượng giảm về 0 | API_CART_02 | 1. Giảm dần bằng `POST /api/cart/remove` (decrement)<br>2. Lặp đến khi qty = 0<br>3. Đọc cart | Khi qty về 0, item bị xóa khỏi `cartData` | `TD-API-CART-USER-EMAIL`, `TD-API-CART-FOOD-NAMES` | PASS |
| API_CART_07 | Integration | Verify User B không thể xem giỏ hàng của User A | API_CART_01 | 1. Seed cart cho User A<br>2. Đăng nhập User B<br>3. User B gọi `GET /api/cart/get` (spoof ID A nếu cần) | API phải trả 403 hoặc cart rỗng; hiện Jest báo backend trả cart của A (bug) | `TD-API-CART-USER-EMAIL`, `TD-API-CART-FOOD-NAMES` | FAIL |
| API_CART_08 | Integration | Verify giới hạn số lượng tối đa 1 món trong giỏ | User Token | 1. Thiết lập env `MAX_ITEM_QTY = 2` và thêm món cho đủ limit<br>2. `POST /api/cart/add` lần nữa vượt quá limit<br>3. Đối chiếu phản hồi | HTTP `400`, message `Max quantity reached`; hiện backend chưa enforce (ghi chú bug) | `TD-API-CART-USER-EMAIL`, `TD-API-CART-FOOD-NAMES`, `TD-API-CART-LIMITS` | FAIL |
